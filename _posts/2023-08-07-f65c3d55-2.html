---
layout: post
cover: 'assets/images/f65c3d55-cover-globe.jpg'
navigation: True
title: Managing Global API Deployments in CloudHub (Part 2)
date: 2023-08-06 12:11:45
tags: architecture
subclass: 'post tag-test tag-content'
logo: 'assets/images/odyssey-logo-clean.png'
author: jeroen
categories: jeroen
---

<p>Global organizations require global IT infrastructure to support their processes, and APIs are no exceptions to this requirement.
In Part 2 of this blog post series, we will discuss the solution design and the implementation steps for the business requirements discussed in <a href="/f65c3d55-1.html">Part 1</a>.</p>

<hr />
<h3>Table of Contents</h3>

<h5><a href="#solution-design">Solution design</a></h5>

<hr />

<h4><a name="solution-design">Solution design</a></h4>

After thorough analysis of the requirements and available <a href="https://docs.mulesoft.com/cloudhub-2/ch2-architecture#regions-and-dns-records">CloudHub regions</a>, the ACME Inc. <em>Center for Enablement (C4E)</em> has come up with the following Action Plan.

<ol>
  <li>Create and configure Private Spaces in Regions <em>eu-central-1 (deu-c1)</em> and <em>us-east-1 (usa-e1)</em></li>
  <li>Check configuration of existing VPC and DLB in Region <em>ap-northeast-2 (au-s1)</em></li>
  <li>Deploy <em>Orders API</em> to the three environments</li>
  <li>Configure AWS Route 53 with required DNS Records and geolocation policies</li>
</ol>

<h5>Solution design diagram</h5>

<p>The diagram below shows the solution design and the components required for the implementation. Applications will (continue to) use the vanity domain <em>api.acme.com</em>, 
  whereby Route 53 will be configured to ensure geographical routing based on the application's location.</p> 
<p><img src="/assets/images/f65c3d55-1-diagram.png" alt="Solution design diagram" /></p>

<p>Now let's get started with the implementation!</p>

<h5>Create Private Spaces in Anypoint Platform</h5>

  <ol>
    <li>Create a Private Space in Region <em>Europe (Frankfurt)</em> by following the steps described <a href="https://docs.mulesoft.com/cloudhub-2/ps-create-configure">here</a>.</li>

    The team names this Private Space <em>acme-priv-sp-deu-c1</em>.
    <li>Create a Private Space in Region <em>US East (Northern Virginia)</em> following the same steps as above.</li>

    The team names this Private Space <em>acme-priv-sp-usa-e1</em>
  </ol>

<p>The creation of the Private Spaces will run in the background and will take approximately 30 minutes to complete. 

<h5>Create TLS Context</h5>
<p>The C4e at ACME Inc. has already gathered the needed PEM-files from their networking team to configure the Private Space with a TLS Context 
  for <em>api.acme.com</em>, which they complete by following the steps described <a href="https://docs.mulesoft.com/cloudhub-2/ps-config-domains#create-tls-context">here</a> in both Private Spaces. </p>

<h5>Check configuration of existing VPC and DLB</h5>
<p>The C4E has decided to deploy the Orders API with the application name <em>acme-inc-orders-api</em> in all environments. As this name is available and unique inside the VPC,
  and the mapping rule inside the DLB has already been set up to forward API calls to the corresponding Mule App, no further changes are needed.</p>

<h5>Deploy the <em>Orders API</em></h5>
<p>The C4E Team goes ahead and deploys the <em>Orders API</em> to the 2 Private Spaces in Frankfurt and Northern Virginia and to the VPC in Australia, a major milestone!
  After some sanity checks and test calls, all signs are green to go ahead with the global implementation.</p>

<h5>Configure AWS Route 53</h5>
<p>Now it's time to bring it all together. The C4E Team collaborates with the networking team to configure AWS Route 53. </p>
<p>The team ends up creating the following DNS records in AWS Route 53.</p>

<table>
<tbody>
<tr>
<th>Name</th>
<th>Routing</th>
<th>Differentiator</th>
<th>Value</th>
</tr>
<tr>
<td>Division 1</td>
<td>Division 2</td>
<td>Division 3</td>
</tr>
<tr class="even">
<td>Division 1</td>
<td>Division 2</td>
<td>Division 3</td>
</tr>
<tr>
<td>Division 1</td>
<td>Division 2</td>
<td>Division 3</td>
</tr>
</tbody>
</table>




